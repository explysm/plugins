(function(c,f,u,h,a,E,k,S,m,y,P){"use strict";const D=u.findByProps("getChannel","getDMFromUserId"),I=u.findByProps("_channelMessages"),Z=u.findByProps("getMessage","getMessages");function x(r){return f.before("dispatch",a.FluxDispatcher,function(s){if(c.isEnabled)try{const n=s[0];if(!n||!n.type)return;if(n.type==="MESSAGE_DELETE"){if(n.otherPluginBypass)return;const e=I.get(n.channelId)?.get(n.id);if(!e?.author?.id||!e.author.username||e?.author?.bot&&e?.flags==64||e.author.bot||!e.content&&!e.attachments?.length&&!e.embeds?.length)return;const t=r.get(n.id);if(t?.stage===2){r.size>=100&&(r=new Map);return}if(t?.stage===1)return t.stage=2,t.message||s;const l=D.getChannel(e.channel_id||n.channelId)?.guild_id;return n.message={...e,content:e.content,channel_id:e.channel_id||n.channelId,guild_id:l,message_reference:e?.message_reference||e?.messageReference||null,flags:64},n.type="MESSAGE_UPDATE",n.channelId=e.channel_id||n.channelId,n.optimistic=!1,n.sendMessageOptions={},n.isPushNotification=!1,r.set(n.id,{message:s,stage:1}),s}if(n.type==="MESSAGE_UPDATE"){if(n.otherPluginBypass)return;const e=n.message;if(!e||e.author?.bot)return;if(c.isEditingSelf)return _(!1),s;const t=e.channel_id||n.channelId,l=e.id||n.id,i=Z.getMessage(t,l)||I.get(t)?.get(l);if(!i?.author?.id||!i.author.username||!i.content&&!i.attachments?.length&&!i.embeds?.length||!e.content||e.content===i.content)return;let d="`[ EDITED ]`\n\n";return n.message={...e,content:`${i.content} ${d}${e.content}`,guild_id:D.getChannel(t)?.guild_id??e.guild_id,edited_timestamp:"invalid_timestamp",message_reference:e?.message_reference||i?.messageReference||null},s}}catch(n){h.showToast("[ANTIED Zero] FluxDispatcher crash \u2013 check logs"),console.error(`[ANTIED Zero] Flux patch
`,n)}})}const G=u.findByProps("sendMessage","startEditMessage");function z(){return f.before("startEditMessage",G,function(r){if(!c.isEnabled)return;_(!0);const s=b("`[ EDITED ]`\n\n"),n=new RegExp(s,"gmi"),[,,e]=r,t=e.split(n),l=t[t.length-1];r[2]=l})}const M=u.findByProps("openLazy","hideActionSheet"),Q=u.findByProps("getMessage","getMessages"),V=u.findByProps("getChannel","getDMFromUserId"),j=u.findByProps("_channelMessages"),{ActionSheetRow:v}=u.findByProps("ActionSheetRow");function w(r){return r?.props?.label?.toLowerCase?.()=="reply"}function O(){return f.before("openLazy",M,function([r,s,n]){if(c.isEnabled)try{const e=n?.message;if(s!=="MessageLongPressActionSheet"||!e)return;r.then(function(t){const l=f.after("default",t,function(i,d){try{a.React.useEffect(function(){return function(){l()}},[]);const o=k.findInReactTree(d,function(A){return A?.find?.(w)});if(!o)return d;const ie=Math.max(o.findIndex(w),o.length-1);let g=null;if(e?.channel_id&&e?.id&&(g=Q.getMessage(e?.channel_id,e?.id),g||(g=j.get(e?.channel_id)?.get(e?.id))),!g)return d;const se=b("`[ EDITED ]`\n\n"),L=new RegExp(se,"gmi");if(L.test(e.content)){const A=ie||1;o.splice(A,0,a.React.createElement(v,{label:"Remove Edit History",subLabel:"Added by Antied Zero",icon:a.React.createElement(v.Icon,{source:E.getAssetIDByName("ic_edit_24px")}),onPress:function(){const U=e?.content?.split(L),le=U[U.length-1];a.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{...e,message_reference:e?.message_reference||e?.messageReference||null,content:`${le}`,guild_id:V.getChannel(g.channel_id).guild_id},otherPluginBypass:!0}),M.hideActionSheet(),h.showToast("History Removed",E.getAssetIDByName("ic_edit_24px"))}}))}}catch(o){h.showToast("[ANTIED Zero] Crash on ActionSheet, check debug log for more info"),console.error(`[ANTIED Zero] Error > ActionSheet:Component Patch
`,o)}})})}catch(e){h.showToast("[ANTIED Zero] Crash on ActionSheet, check debug log for more info"),console.error(`[ANTIED Zero] Error > ActionSheet Patch
`,e)}})}const T=u.findByStoreName("UserStore"),{ScrollView:H,View:B,Image:F}=y.General,{FormArrow:W,FormRow:p,FormSection:R,FormDivider:N}=y.Forms,K=[{name:"Angel",role:"Author & Maintainer",uuid:"692632336961110087"}],q=[{name:"Moodle",role:"Quality Assurance",uuid:"807170846497570848"},{name:"Rairof",role:"Quality Assurance",uuid:"923212189123346483"},{name:"Catinette",role:"Quality Assurance",uuid:"1302022854740807730"},{name:"Win8.1VMUser",role:"Quality Assurance",uuid:"793935599702507542"}],J=[{label:"Source Code",url:"https://github.com/angelix1/MP"},{label:"Tip via PayPal",url:"https://paypal.me/alixymizuki"},{label:"Buy me a Ko-fi",url:"https://ko-fi.com/angel_wolf"}];function X(){S.useProxy(m.storage);const r=function(t){return a.url.openURL(t).catch(function(){})},s=function(t){return T?.getUser(t)||Object.values(T?.getUsers()).find(function(l){return l.id===t})||null},n=function(t){return s(t)?.getAvatarURL?.()?.replace("webp","png")||null},e=function(t){return a.React.createElement(F,{source:{uri:t},style:{width:40,height:40,borderRadius:20}})};return a.React.createElement(a.React.Fragment,null,a.React.createElement(H,null,a.React.createElement(R,{title:"Developers"},K.map(function(t,l){const i=n(t?.uuid);return a.React.createElement(p,{key:l,label:t.name,subLabel:t.role,leading:i?e(i):null})})),a.React.createElement(R,{title:"Testers"},q.map(function(t,l){const i=n(t?.uuid);return a.React.createElement(p,{key:l,label:t.name,subLabel:t.role,leading:i?e(i):null})})),a.React.createElement(N,null),a.React.createElement(R,{title:"Support & Source"},a.React.createElement(B,{style:{margin:50}},J.map(function(t,l){let i=t.icon?t.icon?.startsWith("https")?a.React.createElement(F,{source:{uri:t.icon},style:{width:120,height:40}}):a.React.createElement(p.Icon,{source:E.getAssetIDByName(t.icon)}):null;return a.React.createElement(p,{key:l,label:t.label,leading:i,trailing:a.React.createElement(W,null),onPress:function(){return r(t.url)}})}))),a.React.createElement(N,null),a.React.createElement(B,{style:{height:40}})))}const{FormRow:$}=y.Forms;function Y(){S.useProxy(m.storage);const r=a.NavigationNative.useNavigation(),s=function(){r.push("VendettaCustomPage",{title:"Credits & Support",render:function(){return a.React.createElement(X)}})};return a.React.createElement(a.React.Fragment,null,a.React.createElement($,{label:"CREDITS",subLabel:"See the people behind the plugin and ways to support its development.",onPress:s,trailing:a.React.createElement($.Icon,{source:E.getAssetIDByName("ic_arrow_right")})}))}const b=function(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};c.isEnabled=!1,c.isEditingSelf=!1;const _=function(r){return c.isEditingSelf=r},ee=new Map;let C;const te=[[x,[ee]],[O,[]],[z,[]]],ne=function(){return te.forEach(function([r,s]){return r(...s)})},ae="https://angelix1.github.io/static_list/antied/list.json";C=ne();var re={onLoad:async function(){const r=await P.fetchDB(ae);P.selfDelete(r,15),c.isEnabled=!0},onUnload:function(){c.isEnabled=!1,C?.()},settings:Y};return c.default=re,c.regexEscaper=b,c.setIsEditingSelf=_,Object.defineProperty(c,"__esModule",{value:!0}),c})({},vendetta.patcher,vendetta.metro,vendetta.ui.toasts,vendetta.metro.common,vendetta.ui.assets,vendetta.utils,vendetta.storage,vendetta.plugin,vendetta.ui.components,bl);
