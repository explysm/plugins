(function(T,v,y,t,_,L,l,c,V,D,J,R,Y,f,d){"use strict";const N=y.findByProps("openLazy","hideActionSheet"),G=y.findByProps("ActionSheetRow")?.ActionSheetRow??c.Forms.FormRow,q=y.findByStoreName("MessageStore"),W=y.findByStoreName("ChannelStore"),X=`
`,Q=t.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:L.semanticColors.INTERACTIVE_NORMAL}});let A=[];function Z(){return _.before("openLazy",N,function([a,n,o]){const i=o?.message;n!=="MessageLongPressActionSheet"||!i||a.then(function(r){const s=_.after("default",r,function(U,xe){t.React.useEffect(function(){return function(){s()}},[]);const I=V.findInReactTree(xe,function(h){return h?.[0]?.type?.name==="ActionSheetRow"});if(!I)return;const _e=Math.max(I.findIndex(function(h){return h.props.message===t.i18n.Messages.MARK_UNREAD}),0),p=q.getMessage(i.channel_id,i.id);if(!p?.content&&!i.content)return;const b=p?.id??i.id,P=p?.content??i.content,C=A.find(function(h){return Object.keys(h)[0]===b},"cache object"),$=C?"Revert":"Translate",H=$==="Translate"?l.getAssetIDByName("LanguageIcon"):l.getAssetIDByName("ic_highlight"),Le=async function(){N.hideActionSheet();try{const m=e.target_lang,k=$==="Translate",De=e.immersive_enabled;if(!p)return;const Ne=/<(a?):\w+:\d+>|<@!?\d+>|<#\d+>/g,x=[],Ge=P.replace(Ne,function(w){return x.push(w),` [[${x.length-1}]] `});var h;h=await h(Ge,void 0,m,!k);let S=h.text;x.forEach(function(w,Fe){const Be=new RegExp(`\\[\\[\\s*${Fe}\\s*\\]\\]`,"g");S=S.replace(Be,w)});const Me=k?De?`${P}${X}${S.trim()} \`[${m?.toLowerCase()}]\``:`${S.trim()} \`[${m?.toLowerCase()}]\``:C[b];t.FluxDispatcher.dispatch({type:"MESSAGE_UPDATE",message:{id:b,channel_id:p.channel_id,guild_id:W.getChannel(p.channel_id)?.guild_id,content:Me},log_edit:!1,otherPluginBypass:!0}),k?A.unshift({[b]:P}):A=A.filter(function(w){return w!==C},"cached data override")}catch(m){d.showToast("Failed to translate message. Please check Debug Logs for more info.",l.getAssetIDByName("Small")),D.logger.error(m)}};I.splice(_e,0,t.React.createElement(G,{label:`${$} Message`,icon:t.React.createElement(G.Icon,{source:H,IconComponent:function(){return t.React.createElement(t.ReactNative.Image,{resizeMode:"cover",style:Q.iconComponent,source:H})}}),onPress:Le}))})})})}const M={Arabic:"AR",Bulgarian:"BG",Czech:"CS",Danish:"DA",German:"DE",Greek:"EL",English:"EN",Spanish:"ES",Estonian:"ET",Finnish:"FI",French:"FR",Hungarian:"HU",Indonesian:"ID",Italian:"IT",Japanese:"JA",Korean:"KO",Lithuanian:"LT",Latvian:"LV",Norwegian:"NO",Dutch:"NL",Polish:"PL",Portuguese:"PT",Romanian:"RO",Russian:"RU",Slovak:"SK",Slovenian:"SL",Swedish:"SV",Turkish:"TR",Ukrainian:"UK","Chinese-Simplified":"ZH"},ee={Afrikaans:"af",Albanian:"sq",Amharic:"am",Arabic:"ar",Armenian:"hy",Assamese:"as",Aymara:"ay",Azerbaijani:"az",Bambara:"bm",Basque:"eu",Belarusian:"be",Bengali:"bn",Bhojpuri:"bho",Bosnian:"bs",Bulgarian:"bg",Catalan:"ca",Cebuano:"ceb",Chichewa:"ny","Chinese (Simplified)":"zh-CN","Chinese (Traditional)":"zh-TW",Corsican:"co",Croatian:"hr",Czech:"cs",Danish:"da",Dhivehi:"dv",Dogri:"doi",Dutch:"nl",English:"en",Esperanto:"eo",Estonian:"et",Ewe:"ee",Filipino:"tl",Finnish:"fi",French:"fr",Frisian:"fy",Galician:"gl",Georgian:"ka",German:"de",Greek:"el",Guarani:"gn",Gujarati:"gu","Haitian Creole":"ht",Hausa:"ha",Hawaiian:"haw",Hebrew:"iw",Hindi:"hi",Hmong:"hmn",Hungarian:"hu",Icelandic:"is",Igbo:"ig",Ilocano:"ilo",Indonesian:"id",Irish:"ga",Italian:"it",Japanese:"ja",Javanese:"jw",Kannada:"kn",Kazakh:"kk",Khmer:"km",Kinyarwanda:"rw",Konkani:"gom",Korean:"ko",Krio:"kri","Kurdish (Kurmanji)":"ku","Kurdish (Sorani)":"ckb",Kyrgyz:"ky",Lao:"lo",Latin:"la",Latvian:"lv",Lingala:"ln",Lithuanian:"lt",Luganda:"lg",Luxembourgish:"lb",Macedonian:"mk",Maithili:"mai",Malagasy:"mg",Malay:"ms",Malayalam:"ml",Maltese:"mt",Maori:"mi",Marathi:"mr","Meiteilon (Manipuri)":"mni-Mtei",Mizo:"lus",Mongolian:"mn","Myanmar (Burmese)":"my",Nepali:"ne",Norwegian:"no","Odia (Oriya)":"or",Oromo:"om",Pashto:"ps",Persian:"fa",Polish:"pl",Portuguese:"pt",Punjabi:"pa",Quechua:"qu",Romanian:"ro",Russian:"ru",Samoan:"sm",Sanskrit:"sa","Scots Gaelic":"gd",Sepedi:"nso",Serbian:"sr",Sesotho:"st",Shona:"sn",Sindhi:"sd",Sinhala:"si",Slovak:"sk",Slovenian:"sl",Somali:"so",Spanish:"es",Sundanese:"su",Swahili:"sw",Swedish:"sv",Tajik:"tg",Tamil:"ta",Tatar:"tt",Telugu:"te",Thai:"th",Tigrinya:"ti",Tsonga:"ts",Turkish:"tr",Turkmen:"tk",Twi:"ak",Ukrainian:"uk",Urdu:"ur",Uyghur:"ug",Uzbek:"uz",Vietnamese:"vi",Welsh:"cy",Xhosa:"xh",Yiddish:"yi",Yoruba:"yo",Zulu:"zu"},te="https://deeplx.mingming.dev/translate";var ae={translate:async function(a,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:a};const r=await(await fetch(te,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:a,source_lang:n,target_lang:o})})).json();if(r.code!==200)throw Error(`Failed to translate text from DeepL: ${r.message}`);return{source_lang:n,text:r.data}}catch(r){throw Error(`Failed to fetch from DeepL: ${r}`)}}},ne={translate:async function(a,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:a};const r="https://translate.googleapis.com/translate_a/single?"+new URLSearchParams({client:"gtx",sl:n,tl:o,dt:"t",dj:"1",source:"input",q:a}),s=await(await fetch(r)).json();return{source_lang:n,text:s.sentences.map(function(U){return U.trans}).join("")}}catch(r){throw Error(`Failed to fetch from Google Translate: ${r}`)}}};const re="https://openrouter.ai/api/v1/chat/completions";var oe={translate:async function(a,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:a};if(!e.openRouterApiKey)throw new Error("OpenRouter API Key is not set in settings.");const r=e.openRouterModel||"openai/gpt-3.5-turbo",s=await(await fetch(re,{method:"POST",headers:{Authorization:`Bearer ${e.openRouterApiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:r,messages:[{role:"system",content:`You are a highly accurate language translator. Translate the user's message from ${n} to ${o}. Only return the translated text, without any additional conversational filler.`},{role:"user",content:a}]})})).json();if(s.choices&&s.choices.length>0&&s.choices[0].message)return{source_lang:n,text:s.choices[0].message.content.trim()};throw new Error(`OpenRouter translation failed: ${s.error?.message||"Unknown error"}`)}catch(r){throw new Error(`Failed to fetch from OpenRouter: ${r instanceof Error?r.message:String(r)}`)}}};const ie="https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent";var se={translate:async function(a,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:a};if(!e.googleAIApiKey)throw new Error("Google AI API Key is not set in settings.");const r=e.googleAIModel||"gemini-pro",s=await(await fetch(`${ie}?key=${e.googleAIApiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:`Translate the following text from ${n} to ${o}. Only return the translated text, without any additional conversational filler.

${a}`}]}]})})).json();if(s.candidates&&s.candidates.length>0&&s.candidates[0].content?.parts.length>0)return{source_lang:n,text:s.candidates[0].content.parts[0].text.trim()};throw new Error(`Google AI translation failed: ${s.promptFeedback?.blockReason||s.error?.message||"Unknown error"}`)}catch(r){throw new Error(`Failed to fetch from Google AI: ${r instanceof Error?r.message:String(r)}`)}}};const le="https://api.openai.com/v1/chat/completions";var ce={translate:async function(a,n="auto",o,i=!1){try{if(i)return{source_lang:n,text:a};if(!e.chatGPTApiKey)throw new Error("ChatGPT API Key is not set in settings.");const r=e.chatGPTModel||"gpt-3.5-turbo",s=await(await fetch(le,{method:"POST",headers:{Authorization:`Bearer ${e.chatGPTApiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:r,messages:[{role:"system",content:`You are a highly accurate language translator. Translate the user's message from ${n} to ${o}. Only return the translated text, without any additional conversational filler.`},{role:"user",content:a}]})})).json();if(s.choices&&s.choices.length>0&&s.choices[0].message)return{source_lang:n,text:s.choices[0].message.content.trim()};throw new Error(`ChatGPT translation failed: ${s.error?.message||"Unknown error"}`)}catch(r){throw new Error(`Failed to fetch from ChatGPT: ${r instanceof Error?r.message:String(r)}`)}}};const ue=v.storage,ge={0:ae.translate,1:ne.translate,2:oe.translate,3:se.translate,4:ce.translate},he=async function(a,n="auto",o,i=!1){const r=ge[ue.translator];if(!r)throw new Error("No translator selected or invalid translator ID.");return r(a,n,o,i)},de=y.findByProps("sendBotMessage"),fe=Object.entries(M).map(function([a,n]){return{name:a,displayName:a,value:n}});function pe(){return J.registerCommand({name:"translate",displayName:"translate",description:"Send a message using Dislate in any language chosen.",displayDescription:"Send a message using Dislate in any language chosen.",applicationId:"-1",type:R.ApplicationCommandType.CHAT,inputType:R.ApplicationCommandInputType.BUILT_IN_TEXT,options:[{name:"text",displayName:"text",description:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",displayDescription:"The text/message for Dislate to translate. Please note some formatting of mentions and emojis may break due to the API.",type:R.ApplicationCommandOptionType.STRING,required:!0},{name:"language",displayName:"language",description:"The language that Dislate will translate the text into. This can be any language from the list.",displayDescription:"The language that Dislate will translate the text into. This can be any language from the list.",type:R.ApplicationCommandOptionType.STRING,choices:[...fe],required:!0}],async execute(a,n){const[o,i]=a;try{var r=await he(o.value,void 0,i.value);return await new Promise(function(s){return Y.showConfirmationAlert({title:"Are you sure you want to send it?",content:React.createElement(c.Codeblock,null,r.text),confirmText:"Yep, send it!",onConfirm:function(){return s({content:r.text})},cancelText:"Nope, don't send it"})})}catch(s){return D.logger.error(s),de.sendBotMessage(n.channel.id,"Failed to translate message. Please check Debug Logs for more info.")}}})}const{FormRow:E}=c.Forms,{ScrollView:F}=t.ReactNative;function ye(){f.useProxy(e);const[a,n]=t.React.useState("");return e.translator==0?t.React.createElement(F,{style:{flex:1}},t.React.createElement(c.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:function(o){n(o)}}),Object.entries(M).filter(function([o,i]){return o.toLowerCase().includes(a.toLowerCase())}).map(function([o,i]){return t.React.createElement(E,{label:o,trailing:function(){return t.React.createElement(E.Arrow,null)},onPress:function(){e.target_lang!=i&&(e.target_lang=i,d.showToast(`Saved ToLang to ${o}`,l.getAssetIDByName("check")))}})})):t.React.createElement(F,{style:{flex:1}},t.React.createElement(c.Search,{style:{padding:15},placeholder:"Search Language",onChangeText:function(o){n(o)}}),Object.entries(ee).filter(function([o,i]){return o.toLowerCase().includes(a.toLowerCase())}).map(function([o,i]){return t.React.createElement(E,{label:o,trailing:function(){return t.React.createElement(E.Arrow,null)},onPress:function(){e.target_lang!=i&&(e.target_lang=i,d.showToast(`Saved ToLang to ${o}`,l.getAssetIDByName("check")))}})}))}const{FormRow:u}=c.Forms,{ScrollView:me}=t.ReactNative;function we(){return f.useProxy(e),t.React.createElement(me,{style:{flex:1}},t.React.createElement(u,{label:"DeepL",trailing:function(){return t.React.createElement(u.Arrow,null)},onPress:function(){e.translator!=0&&(e.translator=0,d.showToast("Saved Translator to DeepL",l.getAssetIDByName("check")))}}),t.React.createElement(u,{label:"Google Translate",trailing:function(){return t.React.createElement(u.Arrow,null)},onPress:function(){e.translator!=1&&(e.translator=1,d.showToast("Saved Translator to Google Translate",l.getAssetIDByName("check")))}}),t.React.createElement(u,{label:"OpenRouter",trailing:function(){return t.React.createElement(u.Arrow,null)},onPress:function(){e.translator!=2&&(e.translator=2,d.showToast("Saved Translator to OpenRouter",l.getAssetIDByName("check")))}}),t.React.createElement(u,{label:"Google AI",trailing:function(){return t.React.createElement(u.Arrow,null)},onPress:function(){e.translator!=3&&(e.translator=3,d.showToast("Saved Translator to Google AI",l.getAssetIDByName("check")))}}),t.React.createElement(u,{label:"ChatGPT",trailing:function(){return t.React.createElement(u.Arrow,null)},onPress:function(){e.translator!=4&&(e.translator=4,d.showToast("Saved Translator to ChatGPT",l.getAssetIDByName("check")))}}))}const{FormTextInput:B,FormRow:Te}=c.Forms;function Re(){return f.useProxy(e),t.React.createElement(Te,{label:"OpenRouter Settings"},t.React.createElement(B,{value:e.openRouterApiKey,onChange:function(a){return e.openRouterApiKey=a},placeholder:"Enter OpenRouter API Key",spellcheck:!1,autoCorrect:!1}),t.React.createElement(B,{value:e.openRouterModel,onChange:function(a){return e.openRouterModel=a},placeholder:"Enter OpenRouter Model (e.g., openai/gpt-3.5-turbo)",spellcheck:!1,autoCorrect:!1}))}const{FormTextInput:O,FormRow:Ae}=c.Forms;function Ee(){return f.useProxy(e),t.React.createElement(Ae,{label:"Google AI Settings"},t.React.createElement(O,{value:e.googleAIApiKey,onChange:function(a){return e.googleAIApiKey=a},placeholder:"Enter Google AI API Key",spellcheck:!1,autoCorrect:!1}),t.React.createElement(O,{value:e.googleAIModel,onChange:function(a){return e.googleAIModel=a},placeholder:"Enter Google AI Model (e.g., gemini-pro)",spellcheck:!1,autoCorrect:!1}))}const{FormTextInput:K,FormRow:be}=c.Forms;function Se(){return f.useProxy(e),t.React.createElement(be,{label:"ChatGPT Settings"},t.React.createElement(K,{value:e.chatGPTApiKey,onChange:function(a){return e.chatGPTApiKey=a},placeholder:"Enter ChatGPT API Key",spellcheck:!1,autoCorrect:!1}),t.React.createElement(K,{value:e.chatGPTModel,onChange:function(a){return e.chatGPTModel=a},placeholder:"Enter ChatGPT Model (e.g., gpt-3.5-turbo)",spellcheck:!1,autoCorrect:!1}))}const{ScrollView:ve,Text:Ie}=t.ReactNative,{FormRow:g,FormSwitchRow:Pe}=c.Forms,Ce=t.stylesheet.createThemedStyleSheet({subheaderText:{color:L.semanticColors.HEADER_SECONDARY,textAlign:"center",margin:10,marginBottom:50,letterSpacing:.25,fontFamily:t.constants.Fonts.PRIMARY_BOLD,fontSize:14}}),j=function(a){switch(a){case 0:return"DeepL";case 1:return"Google Translate";case 2:return"OpenRouter";case 3:return"Google AI";case 4:return"ChatGPT";default:return"Unknown"}};function $e(){const a=t.NavigationNative.useNavigation();return f.useProxy(e),t.React.createElement(ve,null,t.React.createElement(Pe,{label:"Immersive Translation",subLabel:"Display both original and translation",leading:t.React.createElement(g.Icon,{source:l.getAssetIDByName("ic_chat_bubble_filled_24px")}),value:e.immersive_enabled??!0,onValueChange:function(n){e.immersive_enabled=n}}),t.React.createElement(g,{label:"Translate to",subLabel:e.target_lang?.toLowerCase(),leading:t.React.createElement(g.Icon,{source:l.getAssetIDByName("ic_activity_24px")}),trailing:function(){return t.React.createElement(g.Arrow,null)},onPress:function(){return a.push("VendettaCustomPage",{title:"Translate to",render:ye})}}),t.React.createElement(g,{label:"Translator",subLabel:j(e.translator),leading:t.React.createElement(g.Icon,{source:l.getAssetIDByName("ic_locale_24px")}),trailing:function(){return t.React.createElement(g.Arrow,null)},onPress:function(){return a.push("VendettaCustomPage",{title:"Translator",render:we})}}),(e.translator===2||e.translator===3||e.translator===4)&&t.React.createElement(t.React.Fragment,null,t.React.createElement(g,{label:"AI Translator Settings",subLabel:"Configure API keys and models",leading:t.React.createElement(g.Icon,{source:l.getAssetIDByName("ic_cog_24px")}),trailing:function(){return t.React.createElement(g.Arrow,null)},onPress:function(){let n;switch(e.translator){case 2:n=Re;break;case 3:n=Ee;break;case 4:n=Se;break;default:return}a.push("VendettaCustomPage",{title:`${j(e.translator)} Settings`,render:n})}})),t.React.createElement(Ie,{style:Ce.subheaderText,onPress:function(){return t.url.openURL("https://github.com/Rico040/bunny-plugins")}},`Build: (${v.manifest.hash.substring(0,7)})`))}const e=v.storage;e.target_lang=e.target_lang??"en",e.translator=e.translator??1,e.immersive_enabled=e.immersive_enabled??!0;let z=[];var ke={onLoad:function(){return z=[Z(),pe()]},onUnload:function(){for(const a of z)a()},settings:$e};return T.default=ke,T.settings=e,Object.defineProperty(T,"__esModule",{value:!0}),T})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.ui.assets,vendetta.ui.components,vendetta.utils,vendetta,vendetta.commands,vendetta.types,vendetta.ui.alerts,vendetta.storage,vendetta.ui.toasts);
